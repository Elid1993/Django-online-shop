{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ุณุจุฏ ุฎุฑุฏ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4 text-center">๐ ุณุจุฏ ุฎุฑุฏ</h1>
    <div class="row mb-3">
        <div class="col-md-12 d-flex justify-content-between">
            <button class="btn btn-danger" onclick="clearCart()">๐๏ธ ุฎุงู ฺฉุฑุฏู ุณุจุฏ ุฎุฑุฏ</button>
            <button class="btn btn-success" onclick="checkout()">๐ณ ุชุณูู ุญุณุงุจ</button>
        </div>
    </div>
    <div id="cart-items" class="row g-3">
        <!-- ุขุชูโูุง ุณุจุฏ ุฎุฑุฏ ุงูุฌุง ุจุง ุฌุงูุงุงุณฺฉุฑูพุช ูพุฑ ูุดู -->
    </div>
</div>

<script>
const API_BASE = "https://{{ request.get_host }}/api/orders/cart/";
const API_ORDER = "https://{{ request.get_host }}/api/orders/checkout/";

// ๐ข ุงูุฒูุฏู ูุญุตูู ุจู ุณุจุฏ
function addToCart(productId) {
    fetch(API_BASE + "add_item/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ product_id: productId, quantity: 1 })
    })
    .then(res => res.json())
    .then(data => {
        alert("โ ูุญุตูู ุงุถุงูู ุดุฏ!");
        loadCart();
    })
    .catch(err => alert("โ ุฎุทุง ุฏุฑ ุงูุฒูุฏู ูุญุตูู!"));
}

// ๐ด ุญุฐู ฺฉ ูุญุตูู ุฎุงุต
function removeFromCart(productId) {
    fetch(API_BASE + "remove_item/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ product_id: productId })
    })
    .then(res => res.json())
    .then(data => {
        alert("๐๏ธ ูุญุตูู ุญุฐู ุดุฏ!");
        loadCart();
    })
    .catch(err => alert("โ ุฎุทุง ุฏุฑ ุญุฐู ูุญุตูู!"));
}

// ๐ก ุฎุงู ฺฉุฑุฏู ฺฉู ุณุจุฏ
function clearCart() {
    fetch(API_BASE + "clear_cart/", { method: "POST", headers: { "Content-Type": "application/json" } })
    .then(res => res.json())
    .then(data => {
        alert("๐ ุณุจุฏ ุฎุฑุฏ ุฎุงู ุดุฏ!");
        loadCart();
    })
    .catch(err => alert("โ ุฎุทุง ุฏุฑ ุฎุงู ฺฉุฑุฏู ุณุจุฏ!"));
}

// ๐ณ ุชุณูู ุญุณุงุจ (ุซุจุช ุณูุงุฑุด)
function checkout() {
    fetch(API_ORDER, { method: "POST", headers: { "Content-Type": "application/json" } })
    .then(res => res.json())
    .then(data => {
        alert("โ ุณูุงุฑุด ุดูุง ุซุจุช ุดุฏ! ุดูุงุฑู ุณูุงุฑุด: " + data.id);
        loadCart();
    })
    .catch(err => alert("โ ุฎุทุง ุฏุฑ ุซุจุช ุณูุงุฑุด!"));
}

// ๐ฆ ููุงุด ุขุชูโูุง ุณุจุฏ ุฎุฑุฏ
function loadCart() {
    fetch(API_BASE, { headers: { "Content-Type": "application/json" } })
    .then(res => res.json())
    .then(data => {
        const container = document.getElementById("cart-items");
        container.innerHTML = "";
        if (data.items && data.items.length > 0) {
            data.items.forEach(item => {
                container.innerHTML += `
                    <div class="col-md-4">
                        <div class="card p-3 shadow-sm">
                            <h5>${item.product.name}</h5>
                            <p>ุชุนุฏุงุฏ: ${item.quantity}</p>
                            <p>ููุช: ${item.product.price} ุชููุงู</p>
                            <button class="btn btn-sm btn-danger" onclick="removeFromCart(${item.product.id})">ุญุฐู</button>
                        </div>
                    </div>
                `;
            });
        } else {
            container.innerHTML = "<p class='text-center'>๐๏ธ ุณุจุฏ ุฎุฑุฏ ุดูุง ุฎุงู ุงุณุช.</p>";
        }
    });
}

// ููุช ุตูุญู ููุฏ ุดุฏ โ ุณุจุฏ ุฎุฑุฏ ููุงุด ุฏุงุฏู ุจุดู
document.addEventListener("DOMContentLoaded", loadCart);
</script>
</body>
</html>

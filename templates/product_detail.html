{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row">
        <!-- تصویر محصول -->
        <div class="col-md-6">
            {% if product.image %}
                <img src="{{ product.image.url }}" class="img-fluid rounded shadow">
            {% else %}
                <img src="{% static 'images/no-image.png' %}" class="img-fluid rounded shadow">
            {% endif %}
        </div>

        <!-- توضیحات محصول -->
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <p class="text-muted">💰 قیمت: {{ product.price }} تومان</p>
            <p>{{ product.description }}</p>

            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-primary" onclick="addToCart({{ product.id }})">🛒 افزودن به سبد خرید</button>
                <a href="{% url 'cart_view' %}" class="btn btn-success">مشاهده سبد خرید</a>
            </div>
        </div>
    </div>
</div>

<script>
const API_CART = "http://localhost:8000/api/cart/";

// 🟢 افزودن محصول به سبد خرید
function addToCart(productId) {
    fetch(API_CART + "add_item/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({
            product_id: productId,
            quantity: 1
        })
    })
    .then(res => res.json())
    .then(data => {
        alert("✅ محصول به سبد خرید اضافه شد!");
    })
    .catch(err => alert("❌ خطا در افزودن محصول!"));
}
</script>

</body>
</html>
